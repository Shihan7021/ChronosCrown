<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CMS — Products</title>
  <link rel="stylesheet" href="css/cms-style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="css/cms-theme.css">
  <script type="module">
  const cmsUser = JSON.parse(sessionStorage.getItem('cmsUser') || 'null');
  const allowedRoles = ['system', 'Admin', 'Manager', 'Associate'];
  if (!cmsUser || !allowedRoles.includes(cmsUser.role)) {
    alert('Access denied. Login as CMS user.');
    window.location.href = 'cms-login.html';
  }
</script>
</head>
<body>
  <div class="cms-header"><h2>Products Management</h2></div>
  <div id="cmsToast" class="toast hidden"></div>

  <div class="cms-wrapper">
    <div class="cms-sidebar">
      <a href="cms-dashboard.html">Dashboard</a>
      <a href="cms-products.html" class="active">Products</a>
      <a href="cms-users.html">Users</a>
      <a href="cms-content.html">Content</a>
      <a href="cms-sales.html">Sales</a>
      <a href="cms-orders.html">Orders</a>
      <a href="cms-financials.html">Financials</a>
    </div>

    <div class="cms-content">
      <h3>Add / Edit Product</h3>

      <div class="form-card">
        <form id="productForm">
          <div class="form-row">
            <div class="form-group">
              <label>Name</label>
              <input id="productName" type="text" required>
            </div>
            <div class="form-group">
              <label>Model No.</label>
              <input id="productModel" type="text" placeholder="e.g., CC-2025-M01" required>
            </div>
            <div class="form-group">
              <label>Price ($)</label>
              <input id="productPrice" type="number" step="0.01" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Strap Type</label>
              <select id="productStrap" required>
                <option value="">Select strap</option>
                <option>Leather</option>
                <option>Metal</option>
                <option>Silicone</option>
                <option>NATO</option>
                <option>Mesh</option>
              </select>
            </div>

            <div class="form-group">
                <label>Type</label>
                <select id="productType" required>
                <option value="">Select type</option>
                <option>Him</option>
                <option>Her</option>
                </select>
            </div>
            <div class="form-group">
              <label>Brand</label>
              <select id="productBrand" required>
                <option value="">Select brand</option>
                <option>ChronosCrown</option>
                <option>Seiko</option>
                <option>Citizen</option>
                <option>Casio</option>
                <option>Tissot</option>
              </select>
            </div>

            <div class="form-group">
              <label>Color</label>
              <select id="productColor" required>
                <option value="">Select color</option>
                <option>Black</option>
                <option>Silver</option>
                <option>Gold</option>
                <option>Brown</option>
                <option>Blue</option>
              </select>
            </div>

            <div class="form-group">
              <label>Size</label>
              <select id="productSize" required>
                <option value="">Select size</option>
                <option>34mm</option>
                <option>36mm</option>
                <option>38mm</option>
                <option>40mm</option>
                <option>42mm</option>
                <option>44mm</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group" style="flex:1 1 100%; width:100%;">
              <label>Description</label>
              <div class="desc-editor">
                <div class="desc-toolbar">
                  <button type="button" class="icon-btn" data-cmd="bold" title="Bold"><strong>B</strong></button>
                  <button type="button" class="icon-btn" data-cmd="italic" title="Italic"><em>I</em></button>
                  <button type="button" class="icon-btn" data-cmd="underline" title="Underline"><u>U</u></button>
                  <button type="button" class="icon-btn" data-cmd="insertUnorderedList" title="Bulleted List">• List</button>
                </div>
                <div id="productDescEditor" class="editor" contenteditable="true" placeholder="Describe the product..."></div>
                <input type="hidden" id="productDesc" />
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group" style="max-width:220px">
              <label>Quantity (internal)</label>
              <input id="productQty" type="number" min="0" value="0">
            </div>
            <div class="form-group" style="max-width:220px">
              <label>Low stock limit (reorder level)</label>
              <input id="lowStockLimit" type="number" min="0" value="0" placeholder="e.g., 5">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Product Images (multiple — at least 1 on new; optional on edit if images exist)</label>
              <input id="productImages" type="file" accept="image/*" multiple>
              <div id="imagePreview" class="image-preview"></div>
            </div>
          </div>

          <div class="form-row" style="align-items:center; gap:24px;">
            <label style="display:flex; align-items:center; gap:8px;">
              <input id="productFeatured" type="checkbox"> Mark as Featured (max 9)
            </label>
            <label style="display:flex; align-items:center; gap:8px;">
              <input id="productAnimated" type="checkbox"> Mark as Animated (max 3)
            </label>
          </div>

          <div style="display:flex; gap:12px;">
            <button id="addProductBtn" class="btn" type="submit">Save Product</button>
            <button id="clearFormBtn" type="button" class="btn btn-danger">Clear</button>
          </div>
        </form>
      </div>

      <div style="display:flex; align-items:center; justify-content:space-between; margin-top:20px; gap:12px;">
        <h3 style="margin:0;">Products</h3>
        <input id="searchModel" type="text" placeholder="Search by Model No." style="padding:8px 10px; border:1px solid #cbd5e1; border-radius:6px; min-width:260px;">
      </div>

      <!-- Filters -->
      <div id="productFilters" style="display:flex; flex-wrap:wrap; gap:10px; align-items:flex-end; background:#fff; padding:10px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.06); margin:10px 0;">
        <div style="display:flex; flex-direction:column;">
          <label>Brand</label>
          <select id="filterBrand" style="min-width:160px;">
            <option value="">All</option>
            <option>ChronosCrown</option>
            <option>Seiko</option>
            <option>Citizen</option>
            <option>Casio</option>
            <option>Tissot</option>
          </select>
        </div>
        <div style="display:flex; flex-direction:column;">
          <label>Stock Min</label>
          <input id="filterStockMin" type="number" min="0" placeholder="0" style="width:120px;">
        </div>
        <div style="display:flex; flex-direction:column;">
          <label>Stock Max</label>
          <input id="filterStockMax" type="number" min="0" placeholder="9999" style="width:120px;">
        </div>
        <div style="display:flex; flex-direction:column;">
          <label>Price Min</label>
          <input id="filterPriceMin" type="number" min="0" step="0.01" placeholder="0" style="width:120px;">
        </div>
        <div style="display:flex; flex-direction:column;">
          <label>Price Max</label>
          <input id="filterPriceMax" type="number" min="0" step="0.01" placeholder="99999" style="width:120px;">
        </div>
        <div style="display:flex; gap:8px;">
          <button id="applyFilters" class="btn" type="button">Apply</button>
          <button id="clearFilters" class="btn btn-danger" type="button">Clear</button>
        </div>
      </div>

      <div id="productList" class="product-list"></div>
    </div>
  </div>

  <script type="module" src="js/firebase-config.js"></script>
  <script type="module" src="js/cms-products.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
