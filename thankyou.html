<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Thank you - ChronosCrown</title>
<link rel="stylesheet" href="css/styles.css">
</head>
<body>
<header class="header">
  <div class="container nav-wrap">
    <div class="brand">
      <div class="logo"><img src="assets/hero/logo.png" alt="ChronosCrown logo"></div>
      <h1>ChronosCrown</h1>
    </div>
    <nav class="navlinks">
      <a href="index.html">Home</a>
      <a href="him.html">Him</a>
      <a href="her.html">Her</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </nav>
    <div style="display:flex; gap:12px; align-items:center;">
      <a id="loginLink" href="login.html" class="btn secondary" hidden >Sign In</a>
      <a id="registerLink" href="register.html" class="btn" hidden>Register</a>
      <div id="userMenu" class="dropdown hidden">
        <span class="greeting" id="greetingText"></span>
        <div class="person-icon">üë§</div>
        <div class="dropdown-content">
          <a href="profile.html">My Profile</a>
          <a href="#" id="logoutBtn">Logout</a>
        </div>
      </div>
      <a href="cart.html" class="icon-btn" aria-label="Cart">
        <img src="/assets/icons/cart.png" alt="Cart" style="height:22px;">
        <div class="badge cart-badge">0</div>
      </a>
    </div>
  </div>
</header>

<main class="container">
  <h2>Thank you for your order</h2>
  <div id="order-summary" class="form">Loading order details...</div>
</main>
<footer class="footer">
  <div class="container footer-columns">
    <div class="footer-col footer-brand">
      <div class="logo"><img src="assets/hero/logo.png" alt="ChronosCrown logo"></div>
      <h4>ChronosCrown</h4>
      <p class="meta">Timeless watches, modern craft.</p>
      <div class="socials">
        <a href="#" aria-label="Instagram">üì∏</a>
        <a href="#" aria-label="Facebook">üìò</a>
        <a href="#" aria-label="Twitter">üê¶</a>
      </div>
    </div>
    <div class="footer-col">
      <h4>Shop</h4>
      <a href="him.html">Him</a>
      <a href="her.html">Her</a>
      <a href="all-products.html">All Products</a>
    </div>
    <div class="footer-col">
      <h4>Support</h4>
      <a href="about.html">About Us</a>
      <a href="contact.html">Contact</a>
      <a href="track-order.html">Track Order</a>
      <a href="feedback.html">Feedback</a>
      <a href="privacy.html">Privacy Policy</a>
    </div>
    <div class="footer-col">
      <h4>Stay in the loop</h4>
      <form id="newsletterForm" class="newsletter" onsubmit="event.preventDefault(); alert('Subscribed!');">
        <input type="email" placeholder="Your email" required>
        <button class="btn secondary" type="submit">Subscribe</button>
      </form>
    </div>
  </div>
  <div class="container footer-bottom">
    <div>¬© 2025 ChronosCrown</div>
    <div class="meta">Free shipping over $150 ‚Ä¢ 2-year warranty</div>
  </div>
</footer>

<script type="module">
import { db } from './js/firebase.init.js';
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
import { formatCurrency } from './js/utils.js';

const urlParams = new URLSearchParams(location.search);
const orderId = urlParams.get('order') || sessionStorage.getItem('lastOrderId');
const trk = urlParams.get('trk') || sessionStorage.getItem('lastOrderTrk');

const summaryDiv = document.getElementById('order-summary');
if(!orderId){
  summaryDiv.innerHTML = "<p>No order found.</p>";
} else {
  const orderRef = doc(db, 'orders', orderId);
  const orderSnap = await getDoc(orderRef);
  if(!orderSnap.exists()){
    summaryDiv.innerHTML = "<p>Order not found.</p>";
  } else {
    const order = orderSnap.data();
    const items = Array.isArray(order.items) ? order.items : (Array.isArray(order.cart) ? order.cart.map(c=>({price:c.price, qty:c.qty})) : []);
    const amt = typeof order.total === 'number' ? order.total : items.reduce((sum,p)=> sum + (Number(p.price)||0)*(Number(p.qty)||1),0);
    const estDate = order.estimatedDelivery && order.estimatedDelivery.toDate ? order.estimatedDelivery.toDate().toISOString().split('T')[0] : 'N/A';
    summaryDiv.innerHTML = `
      <div>Order: <strong>${orderId}</strong></div>
      <div>Tracking: <strong>${order.trackingNumber || trk || '-'}</strong></div>
      <div>Amount: <strong>${formatCurrency(Number(amt || 0))}</strong></div>
      <div>Estimated Delivery: <strong>${estDate}</strong></div>
      <div style=\"margin-top:12px;\">
        <a href=\"track-order.html?trk=${order.trackingNumber || trk || ''}\" class=\"btn\">Track your order</a>
      </div>
    `;
}
}
</script>

<script type="module" src="js/app.js"></script>
<script type="module" src="js/main-auth.js"></script>
</body>
</html>
