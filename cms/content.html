<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content - TimeMachine CMS</title>
    <link rel="stylesheet" href="../css/cms.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="cms-container">
        <!-- Sidebar -->
        <aside class="cms-sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-clock"></i> TimeMachine CMS</h2>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="products.html"><i class="fas fa-swatchbook"></i> Products</a></li>
                    <li><a href="orders.html"><i class="fas fa-shopping-cart"></i> Orders</a></li>
                    <li><a href="content.html" class="active"><i class="fas fa-edit"></i> Content</a></li>
                    <li><a href="feedback.html"><i class="fas fa-comments"></i> Feedback</a></li>
                    <li><a href="analytics.html"><i class="fas fa-chart-bar"></i> Analytics</a></li>
                    <li><a href="users.html"><i class="fas fa-users"></i> Users</a></li>
                    <li><a href="#" id="logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="cms-main">
            <header class="cms-header">
                <h1>Content Management</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" id="publish-content">
                        <i class="fas fa-rocket"></i> Publish to Live
                    </button>
                </div>
            </header>

            <div class="content-area">
                <!-- Content Tabs -->
                <div class="tabs">
                    <button class="tab-button active" data-tab="homepage">Homepage</button>
                    <button class="tab-button" data-tab="about">About Us</button>
                    <button class="tab-button" data-tab="contact">Contact</button>
                    <button class="tab-button" data-tab="footer">Footer</button>
                </div>

                <!-- Homepage Content -->
                <div id="homepage" class="tab-content active">
                    <div class="section-card">
                        <div class="section-header">
                            <h2>Hero Section</h2>
                        </div>
                        <form class="content-form" data-section="hero">
                            <div class="form-group">
                                <label for="hero-title">Main Title</label>
                                <input type="text" id="hero-title" class="form-control" 
                                       placeholder="Timeless Elegance">
                            </div>
                            <div class="form-group">
                                <label for="hero-subtitle">Subtitle</label>
                                <textarea id="hero-subtitle" class="form-control" rows="3"
                                          placeholder="Discover our premium collection of watches designed for every moment"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="hero-image">Hero Image URL</label>
                                <input type="url" id="hero-image" class="form-control"
                                       placeholder="https://example.com/hero-image.jpg">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>

                    <div class="section-card">
                        <div class="section-header">
                            <h2>Featured Products Section</h2>
                        </div>
                        <form class="content-form" data-section="featured">
                            <div class="form-group">
                                <label for="featured-title">Section Title</label>
                                <input type="text" id="featured-title" class="form-control" 
                                       value="Featured Collections">
                            </div>
                            <div class="form-group">
                                <label>Featured Products</label>
                                <div id="featured-products-list">
                                    <!-- Featured products will be loaded here -->
                                </div>
                                <button type="button" class="btn btn-outline" id="add-featured-product">
                                    <i class="fas fa-plus"></i> Add Product
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- About Us Content -->
                <div id="about" class="tab-content">
                    <div class="section-card">
                        <div class="section-header">
                            <h2>About Us Page</h2>
                        </div>
                        <form class="content-form" data-section="about">
                            <div class="form-group">
                                <label for="about-title">Page Title</label>
                                <input type="text" id="about-title" class="form-control" 
                                       value="About TimeMachine">
                            </div>
                            <div class="form-group">
                                <label for="about-subtitle">Subtitle</label>
                                <input type="text" id="about-subtitle" class="form-control"
                                       value="Our story of craftsmanship and innovation">
                            </div>
                            <div class="form-group">
                                <label for="about-content">Main Content</label>
                                <textarea id="about-content" class="form-control" rows="8">
Founded in 1985, TimeMachine has been at the forefront of watchmaking excellence for nearly four decades. What started as a small workshop in Switzerland has grown into an internationally recognized brand known for precision, quality, and timeless design.

We believe that a watch is more than just a timekeeping device. It's a statement of style, a symbol of achievement, and a companion for life's most precious moments. Our mission is to create timepieces that not only tell time but also tell your story.

Each TimeMachine watch is crafted with meticulous attention to detail. Our master watchmakers combine traditional techniques with modern technology to create timepieces of exceptional quality and durability.
                                </textarea>
                            </div>
                            <div class="form-group">
                                <label for="about-image">About Image URL</label>
                                <input type="url" id="about-image" class="form-control">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Contact Content -->
                <div id="contact" class="tab-content">
                    <div class="section-card">
                        <div class="section-header">
                            <h2>Contact Information</h2>
                        </div>
                        <form class="content-form" data-section="contact">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="contact-address">Address</label>
                                    <input type="text" id="contact-address" class="form-control"
                                           value="123 Watchmaker Street, Geneva, Switzerland 1201">
                                </div>
                                <div class="form-group">
                                    <label for="contact-phone">Phone</label>
                                    <input type="text" id="contact-phone" class="form-control"
                                           value="+41 22 123 4567">
                                </div>
                                <div class="form-group">
                                    <label for="contact-email">Email</label>
                                    <input type="email" id="contact-email" class="form-control"
                                           value="info@timemachine.com">
                                </div>
                                <div class="form-group">
                                    <label for="contact-hours">Business Hours</label>
                                    <textarea id="contact-hours" class="form-control" rows="3">
Monday - Friday: 9:00 AM - 6:00 PM
Saturday: 10:00 AM - 4:00 PM
Sunday: Closed
                                    </textarea>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Footer Content -->
                <div id="footer" class="tab-content">
                    <div class="section-card">
                        <div class="section-header">
                            <h2>Footer Content</h2>
                        </div>
                        <form class="content-form" data-section="footer">
                            <div class="form-group">
                                <label for="footer-description">Company Description</label>
                                <textarea id="footer-description" class="form-control" rows="4">
Premium watches for every occasion. Crafted with precision and style. TimeMachine offers timeless elegance and exceptional craftsmanship in every timepiece.
                                </textarea>
                            </div>
                            <div class="form-group">
                                <label for="footer-copyright">Copyright Text</label>
                                <input type="text" id="footer-copyright" class="form-control"
                                       value="© 2023 TimeMachine. All rights reserved.">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Featured Product Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Featured Product</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div id="products-selector">
                    <!-- Products will be listed here -->
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" id="cancel-product">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirm-product">Add Product</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        if (localStorage.getItem('cmsAuthenticated') !== 'true') {
            window.location.href = 'login.html';
        }

        let siteContent = JSON.parse(localStorage.getItem('site-content')) || {};
        let products = JSON.parse(localStorage.getItem('cms-products')) || [];

        document.addEventListener('DOMContentLoaded', function() {
            loadContent();
            setupEventListeners();
            loadProductsForFeatured();
        });

        function loadContent() {
            // Load saved content or set defaults
            const content = {
                hero: {
                    title: siteContent.hero?.title || 'Timeless Elegance',
                    subtitle: siteContent.hero?.subtitle || 'Discover our premium collection of watches designed for every moment',
                    image: siteContent.hero?.image || ''
                },
                featured: {
                    title: siteContent.featured?.title || 'Featured Collections',
                    products: siteContent.featured?.products || []
                },
                about: {
                    title: siteContent.about?.title || 'About TimeMachine',
                    subtitle: siteContent.about?.subtitle || 'Our story of craftsmanship and innovation',
                    content: siteContent.about?.content || '',
                    image: siteContent.about?.image || ''
                },
                contact: {
                    address: siteContent.contact?.address || '123 Watchmaker Street, Geneva, Switzerland 1201',
                    phone: siteContent.contact?.phone || '+41 22 123 4567',
                    email: siteContent.contact?.email || 'info@timemachine.com',
                    hours: siteContent.contact?.hours || 'Monday - Friday: 9:00 AM - 6:00 PM\nSaturday: 10:00 AM - 4:00 PM\nSunday: Closed'
                },
                footer: {
                    description: siteContent.footer?.description || 'Premium watches for every occasion. Crafted with precision and style.',
                    copyright: siteContent.footer?.copyright || '© 2023 TimeMachine. All rights reserved.'
                }
            };

            // Populate forms
            document.getElementById('hero-title').value = content.hero.title;
            document.getElementById('hero-subtitle').value = content.hero.subtitle;
            document.getElementById('hero-image').value = content.hero.image;

            document.getElementById('featured-title').value = content.featured.title;
            renderFeaturedProducts(content.featured.products);

            document.getElementById('about-title').value = content.about.title;
            document.getElementById('about-subtitle').value = content.about.subtitle;
            document.getElementById('about-content').value = content.about.content;
            document.getElementById('about-image').value = content.about.image;

            document.getElementById('contact-address').value = content.contact.address;
            document.getElementById('contact-phone').value = content.contact.phone;
            document.getElementById('contact-email').value = content.contact.email;
            document.getElementById('contact-hours').value = content.contact.hours;

            document.getElementById('footer-description').value = content.footer.description;
            document.getElementById('footer-copyright').value = content.footer.copyright;
        }

        function setupEventListeners() {
            // Tab functionality
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all tabs and contents
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    button.classList.add('active');
                    document.getElementById(button.dataset.tab).classList.add('active');
                });
            });

            // Form submissions
            document.querySelectorAll('.content-form').forEach(form => {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveSectionContent(this.dataset.section);
                });
            });

            // Add featured product
            document.getElementById('add-featured-product').addEventListener('click', openProductModal);

            // Modal events
            document.querySelector('.close').addEventListener('click', closeModal);
            document.getElementById('cancel-product').addEventListener('click', closeModal);
            document.getElementById('confirm-product').addEventListener('click', addFeaturedProduct);

            // Publish to live
            document.getElementById('publish-content').addEventListener('click', publishToLive);
        }

        function renderFeaturedProducts(featuredProducts) {
            const container = document.getElementById('featured-products-list');
            if (featuredProducts.length === 0) {
                container.innerHTML = '<p class="no-products">No featured products selected.</p>';
                return;
            }

            container.innerHTML = featuredProducts.map(productId => {
                const product = products.find(p => p.id == productId);
                if (!product) return '';
                
                return `
                    <div class="featured-product-item" data-product-id="${product.id}">
                        <img src="${product.image}" alt="${product.name}" class="product-thumb">
                        <div class="product-info">
                            <strong>${product.name}</strong>
                            <span>$${product.price?.toFixed(2)}</span>
                        </div>
                        <button type="button" class="btn btn-sm btn-danger remove-featured" data-product-id="${product.id}">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            }).join('');

            // Add remove event listeners
            container.querySelectorAll('.remove-featured').forEach(button => {
                button.addEventListener('click', function() {
                    removeFeaturedProduct(this.dataset.productId);
                });
            });
        }

        function openProductModal() {
            const container = document.getElementById('products-selector');
            container.innerHTML = products.map(product => `
                <div class="product-selector-item">
                    <input type="radio" name="selected-product" value="${product.id}" id="product-${product.id}">
                    <label for="product-${product.id}">
                        <img src="${product.image}" alt="${product.name}" class="product-thumb">
                        <div class="product-info">
                            <strong>${product.name}</strong>
                            <span>$${product.price?.toFixed(2)} - ${product.category}</span>
                        </div>
                    </label>
                </div>
            `).join('');

            document.getElementById('product-modal').style.display = 'block';
        }

        function addFeaturedProduct() {
            const selectedProduct = document.querySelector('input[name="selected-product"]:checked');
            if (!selectedProduct) {
                alert('Please select a product');
                return;
            }

            const productId = selectedProduct.value;
            if (!siteContent.featured) siteContent.featured = { products: [] };
            if (!siteContent.featured.products.includes(productId)) {
                siteContent.featured.products.push(productId);
                localStorage.setItem('site-content', JSON.stringify(siteContent));
                renderFeaturedProducts(siteContent.featured.products);
                closeModal();
                showNotification('Product added to featured section', 'success');
            } else {
                showNotification('Product is already featured', 'error');
            }
        }

        function removeFeaturedProduct(productId) {
            if (siteContent.featured?.products) {
                siteContent.featured.products = siteContent.featured.products.filter(id => id != productId);
                localStorage.setItem('site-content', JSON.stringify(siteContent));
                renderFeaturedProducts(siteContent.featured.products);
                showNotification('Product removed from featured section', 'success');
            }
        }

        function saveSectionContent(section) {
            const formData = new FormData(document.querySelector(`[data-section="${section}"]`));
            if (!siteContent[section]) siteContent[section] = {};

            // Convert form data to object
            const data = {};
            for (let [key, value] of formData.entries()) {
                const fieldName = key.replace(`${section}-`, '');
                data[fieldName] = value;
            }

            siteContent[section] = { ...siteContent[section], ...data };
            localStorage.setItem('site-content', JSON.stringify(siteContent));
            showNotification(`${section.charAt(0).toUpperCase() + section.slice(1)} content saved successfully`, 'success');
        }

        function publishToLive() {
            // Simulate publishing to live site
            showNotification('Content published to live site successfully!', 'success');
            
            // In real implementation, this would sync with Firebase or your backend
            console.log('Published content:', siteContent);
        }

        function loadProductsForFeatured() {
            // Products are already loaded in the global variable
        }

        function closeModal() {
            document.getElementById('product-modal').style.display = 'none';
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()">&times;</button>
            `;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // Logout functionality
        document.getElementById('logout').addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.removeItem('cmsAuthenticated');
            localStorage.removeItem('isAdmin');
            window.location.href = 'login.html';
        });
    </script>

    <style>
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 2rem;
        }
        .tab-button {
            padding: 1rem 2rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
        }
        .tab-button.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .content-form {
            padding: 2rem;
        }
        .form-actions {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
            text-align: right;
        }
        .featured-product-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        .featured-product-item .product-info {
            flex: 1;
        }
        .no-products {
            padding: 2rem;
            text-align: center;
            color: #666;
            font-style: italic;
        }
        .product-selector-item {
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        .product-selector-item label {
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
        }
        .product-selector-item input[type="radio"] {
            margin-right: 0.5rem;
        }
    </style>
</body>
</html>